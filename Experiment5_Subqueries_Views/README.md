# Experiment 5: Subqueries and Views

## AIM
To study and implement subqueries and views.

## THEORY

### Subqueries
A subquery is a query inside another SQL query and is embedded in:
- WHERE clause
- HAVING clause
- FROM clause

**Types:**
- **Single-row subquery**:
  Sub queries can also return more than one value. Such results should be made use along with the operators in and any.
- **Multiple-row subquery**:
  Here more than one subquery is used. These multiple sub queries are combined by means of ‘and’ & ‘or’ keywords.
- **Correlated subquery**:
  A subquery is evaluated once for the entire parent statement whereas a correlated Sub query is evaluated once per row processed by the parent statement.

**Example:**
```sql
SELECT * FROM employees
WHERE salary > (SELECT AVG(salary) FROM employees);
```
### Views
A view is a virtual table based on the result of an SQL SELECT query.
**Create View:**
```sql
CREATE VIEW view_name AS
SELECT column1, column2 FROM table_name WHERE condition;
```
**Drop View:**
```sql
DROP VIEW view_name;
```

### Question 1
Write a SQL query to Retrieve the names and cities of customers who have the same city as customers with IDs 3 and 7

SAMPLE TABLE: customer
```sql
select name,city from customer where city IN (select city from customer where id in(3,7));
```
OUTPUT

![image](https://github.com/user-attachments/assets/7295594e-6fa1-444c-894b-adf85146b040)

### Question 2
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose Address as Delhi and age below 30

Sample table: CUSTOMERS
```sql
select * from customers where id IN (select id from customers where address='Delhi' and age<30);
```
OUTPUT

![image](https://github.com/user-attachments/assets/35659e74-5a34-449b-9e53-42c40b847633)

### Question 3
Write a SQL query to Find employees who have an age less than the average age of employees with incomes over 1 million

Employee Table
```sql
select * from employee 
where age<(select avg(age) from employee where income>1000000);
```
OUTPUT

![image](https://github.com/user-attachments/assets/2cde6139-cb2b-42c5-b09d-83e401427c23)

### Question 4
Write a SQL query to Retrieve the names of customers who have a phone number that is not shared with any other customer.

SAMPLE TABLE: customer
```sql
select name from customer where phone in (select phone from customer group by phone having count(*)=1);
```
OUTPUT

![image](https://github.com/user-attachments/assets/36790ce4-b811-4153-925b-cfc94a00bec2)

### Question 5
From the following tables write a SQL query to find all orders generated by London-based salespeople. Return ord_no, purch_amt, ord_date, customer_id, salesman_id.

salesman table

name             type
---------------  ---------------
salesman_id      numeric(5)
name                 varchar(30)
city                    varchar(15)
commission       decimal(5,2)

orders table

name             type
---------------  --------
order_no         int
purch_amt        real
order_date       text
customer_id      int
salesman_id      int
 ```sql
select o.ord_no,o.purch_amt,o.ord_date,o.customer_id,o.salesman_id 
from orders o
JOIN salesman s
ON o.salesman_id=s.salesman_id
where o.salesman_id IN(select salesman_id from salesman where city='London' );
```
OUTPUT

![image](https://github.com/user-attachments/assets/bfbe7616-423d-484e-b4f3-40ecc971d0ab)

### Question 6
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is EQUAL TO $1500.

Sample table: CUSTOMERS
```sql
select * from customers where salary=1500;
```
OUTPUT
![image](https://github.com/user-attachments/assets/84a58cb3-99f9-48d7-b19a-fdd8ef266957)

### Question 7
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $1500.

Sample table: CUSTOMERS
```sql
select * from customers where salary>1500;
```
OUTPUT

![image](https://github.com/user-attachments/assets/e33991f6-6502-41e9-b110-5954c3565985)

### Question 8
Write a SQL query that retrieves the all the columns from the Table Grades, where the grade is equal to the minimum grade achieved in each subject.

Sample table: GRADES (attributes: student_id, student_name, subject, grade)
```sql
select * from grades t1
where grade=(select min(grade) from grades t2 where t2.subject=t1.subject);
```

OUTPUT

![image](https://github.com/user-attachments/assets/5fcaeff9-4d0e-4793-8427-d4f5a7954d80)

### Question 9
Write a SQL query to Retrieve the medications with dosages equal to the lowest dosage

Table Name: Medications (attributes: medication_id, medication_name, dosage)
```sql
select medication_id as medic,medication_name,dosage from medications where
dosage=(select min(dosage) from medications);
```
OUTPUT

![image](https://github.com/user-attachments/assets/9b986211-27a9-4c8a-bcda-21bbd4216090)

### Question 10
Write a SQL query to retrieve all columns from the CUSTOMERS table for customers whose salary is greater than $4500.

Sample table: CUSTOMERS
```sql
select * from customers where salary>4500;
```
OUTPUT

![image](https://github.com/user-attachments/assets/7b5adfdb-f65a-4ce9-b962-c76420c7faed)


## RESULT
![image](https://github.com/user-attachments/assets/ddad4fe3-e20e-4dbd-a1d7-eddf6168dabc)

Thus, the SQL queries to implement subqueries and views have been executed successfully.
